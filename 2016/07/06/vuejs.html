<!DOCTYPE HTML>
<!--[if IE 6]><html class="ie6 lte9 lte8 lte7 no-css3" lang="zh-cn"><![endif]-->
<!--[if IE 7]><html class="ie7 lte9 lte8 lte7 no-css3" lang="zh-cn"><![endif]-->
<!--[if IE 8]><html class="ie8 lte9 lte8 no-css3" lang="zh-cn"><![endif]-->
<!--[if IE 9]><html class="ie9 lte9 no-css3" lang="zh-cn"><![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8) | !(IE 9)  ]><!--><html lang="zh-cn" class='non-ie'><!--<![endif]-->
    <head>
        <meta charset="utf-8" />

        
            <meta name="description" content="<p>在项目开发中我多次遇到由于命名冲突导致页面样式混乱，甚至跨模块获取同名元素导致功能失效的情况。对于这种情况，我之前的 <a href="http://blog.lxjwlt.com/front-end/2015/10/08/why-bem"> 一篇文章 </a> 中介绍过如何使用BEM命名法来解决命名冲突的问题。</p>

<p>当项目中引入了BEM命名后，不仅CSS代码，JS代码也应该做相应的调整，以下是我个人实践的总结，如果你也在项目中使用BEM命名，希望本文对你有所帮助。</p>

<p><a href="https://www.zybuluo.com/lxjwlt/note/425246">更好阅读体验&gt;&gt;</a></p>

<h2>JS统一管理模块标识</h2>

<p>当我们提起BEM命名，我们知道一个元素的名称由三部分组成：</p>

<p>BEM = block + element + modifier = 模块名 + 元素名 + 修改器</p>

<p>假设我们有张联系页面，使用BEM命名的模板如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;div class=&quot;contact-page&quot;&gt;
    &lt;div class=&quot;contact-page_header&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre></div>
<p>联系页面的模块标识为contact-page，所以该页面的所有子元素的名称都以contact-page为前缀来命名。</p>

<p>考虑到JS中需要通过模块标识来获取页面元素，而且HTML中手工编写模块标识影响可读性，不利于维护，所以我们将模块标识交由JS来统一管理，而HTML中的模块标识则使用JS模板引擎进行动态插入。</p>

<p>这里我们使用的是Ext.XTemplate引擎：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">),</span>
    <span class="nx">R_Xtpl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;xtpl&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">=</span> <span class="s1">&#39;contact-page&#39;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">((</span><span class="k">new</span> <span class="nx">R_Xtpl</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./index.html&#39;</span><span class="p">))).</span><span class="nx">apply</span><span class="p">({</span>
        <span class="nx">modName</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span>
    <span class="p">}));</span>

    <span class="nx">$wrap</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>在模板中，我们用modName变量代替模块标识：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;{modName}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;{modName}_header&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>这样，阅读HTML时我们只需要关注页面元素名（BEM的E）即可，可读性更好，而且我们能够在JS获取元素。</p>

<h2>模块元素的选择器</h2>

<p>模块标识存储在<code>this.modName</code>中，所以按照BEM命名，我们可以编写以下函数来获取元素的选择器：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>联系页面的header元素的选择器，我们可以这么获取：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">);</span> <span class="c1">// .contact-page_header</span>
</code></pre></div>
<p>目前的selector函数不好的地方在于，每次获取元素选择器都要进行字符串的结合，如果点号(.)或井号(#)写在元素名中就好了，比如<code>this.selector(&#39;.header&#39;)</code>，我们对selector函数进行改进：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">reg</span> <span class="o">=</span> <span class="sr">/^(\.|#)?/</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reg</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">$1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$1</span> <span class="o">=</span> <span class="nx">$1</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">$1</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">modName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>
<p>这样我们就可以根据不同的场景分别获取元素的“名称”或“选择器”：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// .contact-page_header元素有类名contact-page_header</span>
<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">)).</span><span class="nx">hasClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">));</span> <span class="c1">// true</span>
</code></pre></div>
<h2>获取模块元素</h2>

<p>我们已经有了selector方法来获取元素选择器，那么接下来我们可以轻易的实现获取模块元素的接口：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">selector</span> <span class="o">?</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="nx">selector</span><span class="p">))</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>以下用elem方法获取联系页面的头部元素：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">elem</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">);</span>
</code></pre></div>
<h2>引入了VueJS之后</h2>

<p>引入了VueJS之后，我们彻底抛弃了模板引擎库Ext.Xtemplate，我们使用Vue来作为视图层。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">),</span>
    <span class="nx">R_Vue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;Vue&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">=</span> <span class="s1">&#39;contact-page&#39;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">initVm</span><span class="p">(</span><span class="nx">wrap</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initVm</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./index.tpl&#39;</span><span class="p">));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">R_Vue</span> <span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">modName</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="nx">wrap</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">$elem</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">C</span><span class="p">;</span>
</code></pre></div>
<p>引入vue之后我们不再使用类名来获取元素了，因为Vue提供了<a href="http://vuejs.org.cn/api/?#v-el">元素钩子</a>，用来给元素建立索引，我们通过Vue实例的<code>$els</code>访问这些元素。</p>

<p>所以我们的模板可以改为：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;_header&quot;</span> <span class="na">v-el:header</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>(注：类名中保留modName的写法是为了CSS中编写样式)</p>

<p>上面我们使用v-el语法为header元素建立了索引。</p>

<p>获取元素的方法改写为：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">selector</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-([a-zA-Z])/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">$1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$1</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$els</span><span class="p">[</span><span class="nx">selector</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<p>获取header元素：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">elem</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">);</span>
</code></pre></div>
<p>不使用CSS选择器（类名或ID）获取元素的好处在于：
* CSS获取元素和JS获取元素的方式彻底分隔开，互不影响（记得有这么个规定：使用js-前缀的类名获取元素，就是为了达到这个目的）
* 元素已经缓存在Vue实例中，我们不需要手动获取元素，也不需要手动进行缓存，由Vue进行统一的模板管理、元素缓存以及元素的注销</p>

<p>VueJS大法好啊！</p>
" />
        

        <meta name="keywords" content="css,javascript,html5,前端,web,页面制作" />
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=0.5,maximum-scale=2,user-scalable=yes" /><!-- 响应式网页设计：initial-scale设定初始缩放比例 maximum-scale设定允许用户缩放到的最大比例 minimum-scale设定允许用户缩放到的最小比例 值范围从0.0到10.0 user-scalable设定是否允许用户进行手动缩放 值为yes或no -->
        <title>JS模块的BEM命名实践</title>

        <!-- page icon -->
        <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" type="text/css" href="/css/syntax.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" type="text/css" href="/css/main.css" />

    </head>
    <body class="/2016/07/06/vuejs">
        <div class="header">
            <div class="wrap">
                <h1 class="logo">
                    <a href="/">lxjwlt's blog</a>
                </h1>
            </div>
        </div>

        <div class="directory" id="directory">
            <div class="directory__container" id="directory__container"></div>
            <ul class="directory__button-list">
                <li><a href="#" class="directory__button directory__button--expand" id='expand-button'>目录</a></li>
                <li><a href="#" class="directory__button directory__button--top" id='top-button'>top</a></li>
            </ul>
        </div>
        <div class='main wrap'>
        	<ul class="sidebar">
        		<li><a class='to-index-page' href="/">ALL</a></li>
        		
        			<li><a class='to-others-page' href="/others.html">OTHERS[4]</a></li>
        		
        			<li><a class='to-front-end-page' href="/front-end.html">FRONT-END[28]</a></li>
        		
        	</ul>
        	<div class="content post" id="post">
        		<h1 class='post-title'>JS模块的BEM命名实践</h1>
        		<p class='post-date'>2016-07-06</p>
        		<p>在项目开发中我多次遇到由于命名冲突导致页面样式混乱，甚至跨模块获取同名元素导致功能失效的情况。对于这种情况，我之前的 <a href="http://blog.lxjwlt.com/front-end/2015/10/08/why-bem"> 一篇文章 </a> 中介绍过如何使用BEM命名法来解决命名冲突的问题。</p>

<p>当项目中引入了BEM命名后，不仅CSS代码，JS代码也应该做相应的调整，以下是我个人实践的总结，如果你也在项目中使用BEM命名，希望本文对你有所帮助。</p>

<p><a href="https://www.zybuluo.com/lxjwlt/note/425246">更好阅读体验&gt;&gt;</a></p>

<h2>JS统一管理模块标识</h2>

<p>当我们提起BEM命名，我们知道一个元素的名称由三部分组成：</p>

<p>BEM = block + element + modifier = 模块名 + 元素名 + 修改器</p>

<p>假设我们有张联系页面，使用BEM命名的模板如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;div class=&quot;contact-page&quot;&gt;
    &lt;div class=&quot;contact-page_header&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre></div>
<p>联系页面的模块标识为contact-page，所以该页面的所有子元素的名称都以contact-page为前缀来命名。</p>

<p>考虑到JS中需要通过模块标识来获取页面元素，而且HTML中手工编写模块标识影响可读性，不利于维护，所以我们将模块标识交由JS来统一管理，而HTML中的模块标识则使用JS模板引擎进行动态插入。</p>

<p>这里我们使用的是Ext.XTemplate引擎：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">),</span>
    <span class="nx">R_Xtpl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;xtpl&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">=</span> <span class="s1">&#39;contact-page&#39;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">((</span><span class="k">new</span> <span class="nx">R_Xtpl</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./index.html&#39;</span><span class="p">))).</span><span class="nx">apply</span><span class="p">({</span>
        <span class="nx">modName</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span>
    <span class="p">}));</span>

    <span class="nx">$wrap</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>在模板中，我们用modName变量代替模块标识：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;{modName}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;{modName}_header&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>这样，阅读HTML时我们只需要关注页面元素名（BEM的E）即可，可读性更好，而且我们能够在JS获取元素。</p>

<h2>模块元素的选择器</h2>

<p>模块标识存储在<code>this.modName</code>中，所以按照BEM命名，我们可以编写以下函数来获取元素的选择器：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">selector</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>联系页面的header元素的选择器，我们可以这么获取：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">);</span> <span class="c1">// .contact-page_header</span>
</code></pre></div>
<p>目前的selector函数不好的地方在于，每次获取元素选择器都要进行字符串的结合，如果点号(.)或井号(#)写在元素名中就好了，比如<code>this.selector(&#39;.header&#39;)</code>，我们对selector函数进行改进：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">selector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
        <span class="nx">reg</span> <span class="o">=</span> <span class="sr">/^(\.|#)?/</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reg</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">$1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$1</span> <span class="o">=</span> <span class="nx">$1</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">$1</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">modName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>
<p>这样我们就可以根据不同的场景分别获取元素的“名称”或“选择器”：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// .contact-page_header元素有类名contact-page_header</span>
<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">)).</span><span class="nx">hasClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">));</span> <span class="c1">// true</span>
</code></pre></div>
<h2>获取模块元素</h2>

<p>我们已经有了selector方法来获取元素选择器，那么接下来我们可以轻易的实现获取模块元素的接口：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">selector</span> <span class="o">?</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="p">(</span><span class="nx">selector</span><span class="p">))</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$elem</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>以下用elem方法获取联系页面的头部元素：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">elem</span><span class="p">(</span><span class="s1">&#39;.header&#39;</span><span class="p">);</span>
</code></pre></div>
<h2>引入了VueJS之后</h2>

<p>引入了VueJS之后，我们彻底抛弃了模板引擎库Ext.Xtemplate，我们使用Vue来作为视图层。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jquery&#39;</span><span class="p">),</span>
    <span class="nx">R_Vue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;Vue&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">modName</span> <span class="o">=</span> <span class="s1">&#39;contact-page&#39;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">initVm</span><span class="p">(</span><span class="nx">wrap</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initVm</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">wrap</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$elem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./index.tpl&#39;</span><span class="p">));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">R_Vue</span> <span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span> <span class="nx">$elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">modName</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">modName</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="nx">wrap</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">$elem</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">C</span><span class="p">;</span>
</code></pre></div>
<p>引入vue之后我们不再使用类名来获取元素了，因为Vue提供了<a href="http://vuejs.org.cn/api/?#v-el">元素钩子</a>，用来给元素建立索引，我们通过Vue实例的<code>$els</code>访问这些元素。</p>

<p>所以我们的模板可以改为：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;_header&quot;</span> <span class="na">v-el:header</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>(注：类名中保留modName的写法是为了CSS中编写样式)</p>

<p>上面我们使用v-el语法为header元素建立了索引。</p>

<p>获取元素的方法改写为：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">elem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">selector</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-([a-zA-Z])/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">$1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$1</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$els</span><span class="p">[</span><span class="nx">selector</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<p>获取header元素：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">elem</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">);</span>
</code></pre></div>
<p>不使用CSS选择器（类名或ID）获取元素的好处在于：
* CSS获取元素和JS获取元素的方式彻底分隔开，互不影响（记得有这么个规定：使用js-前缀的类名获取元素，就是为了达到这个目的）
* 元素已经缓存在Vue实例中，我们不需要手动获取元素，也不需要手动进行缓存，由Vue进行统一的模板管理、元素缓存以及元素的注销</p>

<p>VueJS大法好啊！</p>

        		<!-- Duoshuo Comment BEGIN -->
        		<div class="ds-thread"></div>
        		<script type="text/javascript">
        			var duoshuoQuery = {short_name:"lxjwlt"};
        			(function() {
        				var ds = document.createElement('script');
        				ds.type = 'text/javascript';ds.async = true;
        				ds.src = 'http://static.duoshuo.com/embed.js';
        				ds.charset = 'UTF-8';
        				(document.getElementsByTagName('head')[0]
        				|| document.getElementsByTagName('body')[0]).appendChild(ds);
        			})();
        		</script>
        		<!-- Duoshuo Comment END -->
        	</div>
        </div>

        <script src="/scripts/sea.js"></script>
        <script>
            seajs.use('post');
        </script>
    </body>
</html>
