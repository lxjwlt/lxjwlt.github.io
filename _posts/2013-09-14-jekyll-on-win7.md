---
layout: post
title: "Jekyll on Win7"
category: others
excerpt: '老早就想用 github-pages 创建一个博客，于是这几天研究了一下 Jekyll，看了 Jekyll 英文文档和相关的博文，感觉英文的文档看起来很吃力，所以搭建好这个博客之后，觉得应该整理一下这方面的资料，总结安装和使用过程中遇到的问题，以备日后不时之需，也希望对大家有所帮助。'
---

{% raw %}

老早就想用 github-pages 创建一个博客，于是这几天研究了一下 Jekyll，看了 Jekyll 英文文档和相关的博文，感觉英文的文档看起来很吃力，所以搭建好这个博客之后，觉得应该整理一下这方面的资料，总结安装和使用过程中遇到的问题，以备日后不时之需，也希望对大家有所帮助。

首先推荐一篇博文——[搭建一个免费的，无限流量的Blog----github Pages和Jekyll入门](http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html)

上述博文介绍如何搭建一个具备基本功能的 github-pages 博客。读完通篇文章，我有个疑惑——搭建一个 github 博客不需要本地安装 Jekyll ，那安装 Jekyll 有什么用呢？后来才了解到，为了方便本地调试，而不需要每次都 push 到 github 中来查看页面效果——*据说 github-pages 更新有延迟*，所以安装本地 Jekyll 是有必要的。

下面会介绍到 Jekyll 的安装和基本使用，这些内容都是基于 **win7 环境**。

##安装
安装 Jekyll 前需要先安装 **Ruby** 和 **Ruby DevKit**，下载地址：[http://rubyinstaller.org/downloads/](http://rubyinstaller.org/downloads/) 。

安装完 Ruby 并**添加进 PATH** 后，解压 Devkit 安装包，进入 Devkit 解压文件根目录下，对其初始化：

	ruby dk.rb init

初始化成功后，控制台会提示`fix config.yml file`，这时用文本编辑器打开 Devkit 解压文件根目录下的`config.yml`文件，并按提示在文本底部添加 **Ruby 的安装路径**，如下：

	# This configuration file contains the absolute path locations of all
	# installed Rubies to be enhanced to work with the DevKit. This config
	# file is generated by the 'ruby dk.rb init' step and may be modified
	# before running the 'ruby dk.rb install' step. To include any installed
	# Rubies that were not automagically discovered, simply add a line below
	# the triple hyphens with the absolute path to the Ruby root directory.
	#
	# Example:
	#
	# ---
	# - C:/ruby19trunk
	# - C:/ruby192dev
	#
	---
	- F:/Ruby200-x64

然后在控制台中继续输入*（此时路径仍是解压包根目录）*：

	ruby dk.rb install

如果没有出错，就可以安装Jekyll了：

	gem install jekyll

>>`gem install`安装时是不会显示任何东西的，这样会让人误以为安装没有开始进行，因此可以添加**大写的**参数`V`，让它显示安装日志：

>>		gem install jekyll -V

接着，检测是否成功安装：

	jekyll -v

如果返回版本号，如`jekyll 1.2.0`，说明成功安装。

##使用
###初始化
Jekyll 安装成功后，在任意目录下，创建一个初始的模板：

	jekyll new myblog

这样该目录下会自动创建一个 myblog 文件夹，其中包含 Jekyll 最基本的架构：

	.
	├── _config.yml
	├── _layouts
	|   ├── default.html
	|   └── post.html
	├── _posts
	|   └── 2013-09-11-welcome-to-jekyll.markdown
	├── css
	|   ├── main.css
	|   └── syntax.css
	└── index.html

此时可以开启本地服务器来查看该页面，将路径指定到 myblog 目录下后运行：

	jekyll serve

如果没有出错，用浏览器打开`http://localhost:4000`就可以在本地查看该页面了。

>>如果控制台提示以下错误：

>>		 Conversion error: There was an error converting '_posts/XXXX-XX-XX-XXXXX.md'

>>该错误是由于没有安装pygments所导致的，可以选择关掉此项功能：打开`_config.yml`文件，将其中的`pygments`项设为`false`。或者参考以下几篇文章来安装pygments：
>>
>>* [Pygments 代码高亮](http://chxt6896.github.io/blog/2011/12/01/blog-pygments.html)
>>* [win7下jekyll使用pygments配置代码高亮](http://www.aaronzh.cn/blog/install-pygments/)
>>* [Windows 安装 Jekyll 若干问题的解决](http://dannyli.net/notes/fix-problems-of-jekyll-on-windows/)

###写博文
首先，博文格式有几点需要注意的：

* 所有博文都必须以YAML front-matter形式开头。
* 博文编码必须是 "以UTF-8无BOM格式编码"，如果是其他格式，可以通过notepad++来进行编码转换。
* 博文必须按照`year-month-day-name-of-blog`这种格式命名，例如：`2013-9-14-my-first-blog`。

所谓的 YAML front-matter ，是指以`---`开头，以`---`结尾的一种形式，用于给文章添加一些有用的信息，如类别、标签、摘要、标题等等，形式如下：

	---
	layout: post
	title: 我的第一篇文章
	category: front-end
	excerpt: '这是我的第一篇博文的摘要！！'
	---

其中`layout`是为该博文指定一个HTML模板，模板统一放在`_layout`文件夹下，默认模板有`default.html`和`post.html`。

这些 YAML 格式的信息都可以用 Liquid 语法写入HTML文件中，当页面解析时，会自动获取这些值，填充进页面中，后面再深入说明。

注意，即使不为博文添加任何信息，也需要按 YAML 形式开头：

	---
	---

写好的博文放入`_post`文件夹中，Jekyll 后台启动后会自动将它解析并添加入页面中。

>>如果博文中有中文编码，在运行`jekyll serve`后可能会提示如下错误：

>>		invalid byte sequence in GBK

>>解决方法：

>>将`<ruby path>\lib\ruby\gems\2.0.0\gems\jekyll-1.2.0\lib\jekyll\convertible.rb`文件中的：

>>		self.content = File.read(File.join(base, name))

>>改为：

>>		self.content = File.read(File.join(base, name), :encoding => "utf-8")

##内部构造
###模板

默认模板中`default.html`构造了页面的基本结构，同时负责引入了css文件和js文件等，大致结构如下：

	<!DOCTYPE html>
	<html>
		<head></head>
		<body>
			<div class='header'></div>
		
			{{ content }}
			
			<div class='footer'></div>
		</body>
	</html>

需要了解的是，模板中都会有`{{ content }}`，当文件套用模板时，该文件的内容是填充到`{{ content }}`中。

###首页

默认首页为根目录下的`index.html`文件，结构如下:

	---
	layout: default
	title: Your New Jekyll Site
	---
	
	<div id="home">
	  <h1>Blog Posts</h1>
	  <ul class="posts">
	    {% for post in site.posts %}
	      <li><span>{{ post.date | date_to_string }}</span> &raquo; <a href="{{ post.url }}">{{ post.title }}</a></li>
	    {% endfor %}
	  </ul>
	</div>

以上编码的作用是在首页中创建一个博文链接的列表。

其中`{% for post in site.posts %}`是 Liquid 语法结构，它的作用是对全部的博文做一个遍历，每次遍历到的对象用`post`来表示；

`{{ post.date }}`是博文的分布时间，默认从博文的命名中获取，也可以在博文开头的 YAML 中随意定义，其后的`date_to_string`是一个参数，用于将该时间转换成一种简化的形式，如：`14 Sep 2013 `。如果喜欢`2013-9-14`这种格式，可以使用另一种参数：`"%Y-%m-%d"`：

	{{ post.date | "%Y-%m-%d" }}

`{{ post.url }}`是博文的链接。

任何在博文 YAML 中定义的信息都可以用`{{ post.XXXXX }}`的形式填充到页面中。

##github-pages

用`jekyll new`语句初始化的文件可以直接在本地服务器正常调试，但如果想在 github-pages 中正常使用，还需要进行一些设置：

1. 在`_config.yml`文件中添加`baseurl`选项，并设置为`/project-name`，比方说 github 上的项目名为‘myFirstBlog’，则该选项应设置为`/myFirstBlog`
2. 在页面引用的所有 JS 或 CSS 文件的链接开头添加`{{ site.baseurl }}`，形如：`{{ site.baseurl }}/path/to/main.css`
3. 给博文链接开头添加`{{ site.baseurl }}`，如：`{{ site.baseurl }}{{ post.url }}`

这样，github-pages 上就能正常使用了。

然而这时候通过本地服务器调试页面时，却发现不能如常使用了，这是由于“设置了`baseurl`，同时改动了一些链接”所导致的。因此进行了以上的设置后，每次打开本地服务器调试页面时，都需要将`baseurl`设置为空字符：

	jekyll serve --baseurl ''

##实用技巧

* `site.categories`存储了博文的所有分类和该分类下所属的博文，循环遍历之：

		{% for category in site.categories %}

			<li>{{ category | first}}</li>
			<li>{{ category | last | size}}</li>

		{% endfor %}

	其中每次循环得到的`category`是一个数组，`category | first`等价于`category[0]`是该分类的名称；`category | last`等价于`category[1]`是该分类下的所有文章，用参数`size`可以获取该分类下所属文章总数。

* 通过判断类别来筛选文章：

		{% for post in site.posts %}{% if post.category == 'front-end' %}

			<a href='{{ site.baseurl }}{{ post.url }}'>{{ post.title }}</a>

		{% endif %}{% endfor %}

	利用以上规则，便可以实现分类页面的效果了。
* 添加多说评论：

	先到[多说](http://duoshuo.com/create-site/)创建一个后台管理。

	创建后，在后台管理选择‘工具’选项，将其中提供的通用代码复制粘贴到博文页面中即可。

* 调试页面：

	本地调试页面时，可以在打开服务器的命令中加入`--watch`：

		jekyll serve --watch

	这样，每次修改页面内容后，通过刷新页面就可以看到修改后的结果了。

##相关链接
###官方文档
* [Jekyll 官方文档](http://jekyllrb.com/docs/home/)
* [Liquid 语法](http://wiki.shopify.com/Liquid)

###博文教程
* [像黑客一样写博客——Jekyll入门](http://www.soimort.org/posts/101/)
* [win7下安装jekyll——在github上创建自己的博客](http://blog.csdn.net/hutaoer06051/article/details/8574010)
* [Running Jekyll on Windows](http://www.madhur.co.in/blog/2011/09/01/runningjekyllwindows.html)
* [用Jekyll构建静态网页](http://yanping.me/cn/blog/2011/12/15/building-static-sites-with-jekyll/)
* [使用Github Pages建独立博客](http://beiyuu.com/github-pages/)
* [为Jekyll添加静态搜索](http://kingauthur.info/2012/12/03/the-things-about-jekyll/)

{% endraw %}